import{S as Ao,i as To,s as Mo,e as a,k as p,w as O,t as s,M as So,c as r,d as o,m as f,a as n,x as G,h as i,b as h,G as t,g as c,y as I,L as xo,q as L,o as N,B as D,v as Co}from"../../chunks/vendor-hf-doc-builder.js";import{I as Je}from"../../chunks/IconCopyLink-hf-doc-builder.js";import{C as Qe}from"../../chunks/CodeBlock-hf-doc-builder.js";function Oo(Kt){let y,$e,_,E,te,U,Xe,oe,Ye,Ee,u,Ze,ae,et,tt,q,ot,at,H,rt,nt,ke,g,k,re,B,st,ne,it,Ae,m,se,lt,ct,ie,ht,pt,le,ft,Te,b,ce,dt,ut,R,mt,vt,Me,P,A,he,j,wt,pe,yt,Se,X,_t,xe,F,Ce,T,gt,fe,bt,Pt,Oe,W,Ge,M,$t,de,Et,kt,Ie,z,Le,Y,At,Ne,K,De,$,S,ue,V,Tt,me,Mt,Ue,x,J,St,ve,xt,Ct,Ot,d,Gt,we,It,Lt,ye,Nt,Dt,_e,Ut,qt,ge,Ht,Bt,qe,v,Rt,be,jt,Ft,Q,Wt,zt,He;return U=new Je({}),B=new Je({}),j=new Je({}),F=new Qe({props:{code:"accelerate config",highlighted:"accelerate config"}}),W=new Qe({props:{code:" Which type of machine are you using?. ",highlighted:' Which <span class="hljs-keyword">type</span> <span class="hljs-type">of </span>machine are you using?. '}}),z=new Qe({props:{code:`compute_environment: LOCAL_MACHINE
deepspeed_config: {}
distributed_type: MPS
downcast_bf16: 'no'
fsdp_config: {}
machine_rank: 0
main_process_ip: null
main_process_port: null
main_training_function: main
mixed_precision: 'no'
num_machines: 1
num_processes: 1
use_cpu: false`,highlighted:`compute_environment: LOCAL_MACHINE
deepspeed_config: {}
distributed_type: MPS
downcast_bf16: <span class="hljs-string">&#x27;no&#x27;</span>
fsdp_config: {}
machine_rank: 0
main_process_ip: null
main_process_port: null
main_training_function: main
mixed_precision: <span class="hljs-string">&#x27;no&#x27;</span>
num_machines: 1
num_processes: 1
use_cpu: <span class="hljs-literal">false</span>`}}),K=new Qe({props:{code:"accelerate launch /examples/cv_example.py --data_dir images",highlighted:"accelerate launch /examples/cv_example.py --data_dir images"}}),V=new Je({}),{c(){y=a("meta"),$e=p(),_=a("h1"),E=a("a"),te=a("span"),O(U.$$.fragment),Xe=p(),oe=a("span"),Ye=s("Accelerated PyTorch Training on Mac"),Ee=p(),u=a("p"),Ze=s(`With PyTorch v1.12 release, developers and researchers can take advantage of Apple silicon GPUs for significantly faster model training.
This unlocks the ability to perform machine learning workflows like prototyping and fine-tuning locally, right on Mac.
Apple\u2019s Metal Performance Shaders (MPS) as a backend for PyTorch enables this and can be used via the new `),ae=a("code"),et=s('"mps"'),tt=s(` device.
This will map computational graphs and primitives on the MPS Graph framework and tuned kernels provided by MPS.
For more information please refer official documents `),q=a("a"),ot=s("Introducing Accelerated PyTorch Training on Mac"),at=s(`
and `),H=a("a"),rt=s("MPS BACKEND"),nt=s("."),ke=p(),g=a("h3"),k=a("a"),re=a("span"),O(B.$$.fragment),st=p(),ne=a("span"),it=s("Benefits of Training and Inference using Apple M1 Chips"),Ae=p(),m=a("ol"),se=a("li"),lt=s("Enables users to train larger networks or batch sizes locally"),ct=p(),ie=a("li"),ht=s(`Reduces data retrieval latency and provides the GPU with direct access to the full memory store due to unified memory architecture.
Therefore, improving end-to-end performance.`),pt=p(),le=a("li"),ft=s("Reduces costs associated with cloud-based development or the need for additional local GPUs."),Te=p(),b=a("p"),ce=a("strong"),dt=s("Pre-requisites"),ut=s(`: To install torch with mps support,
please follow this nice medium article `),R=a("a"),mt=s("GPU-Acceleration Comes to PyTorch on M1 Macs"),vt=s("."),Me=p(),P=a("h2"),A=a("a"),he=a("span"),O(j.$$.fragment),wt=p(),pe=a("span"),yt=s("How it works out of the box"),Se=p(),X=a("p"),_t=s("On your machine(s) just run:"),xe=p(),O(F.$$.fragment),Ce=p(),T=a("p"),gt=s("and answer the questions asked, specifically choose "),fe=a("code"),bt=s("MPS"),Pt=s(" for the query:"),Oe=p(),O(W.$$.fragment),Ge=p(),M=a("p"),$t=s(`This will generate a config file that will be used automatically to properly set
the default options when doing `),de=a("code"),Et=s("accelerate launch"),kt=s(", such as the one shown below:"),Ie=p(),O(z.$$.fragment),Le=p(),Y=a("p"),At=s(`After this configuration has been made, here is how you run the CV example
(from the root of the repo) with MPS enabled:`),Ne=p(),O(K.$$.fragment),De=p(),$=a("h2"),S=a("a"),ue=a("span"),O(V.$$.fragment),Tt=p(),me=a("span"),Mt=s("A few caveats to be aware of"),Ue=p(),x=a("ol"),J=a("li"),St=s("For "),ve=a("code"),xt=s("nlp_example.py"),Ct=s(` the metrics are too bad when compared to CPU-only training.
This means certain operations in BERT model are going wrong using mps device and this needs to be fixed by PyTorch.`),Ot=p(),d=a("li"),Gt=s("Distributed setups "),we=a("code"),It=s("gloo"),Lt=s(" and "),ye=a("code"),Nt=s("nccl"),Dt=s(" are not working with "),_e=a("code"),Ut=s("mps"),qt=s(` device.
This means that currently only single GPU of `),ge=a("code"),Ht=s("mps"),Bt=s(" device type can be used."),qe=p(),v=a("p"),Rt=s("Finally, please, remember that, \u{1F917} "),be=a("code"),jt=s("Accelerate"),Ft=s(` only integrates MPS backend, therefore if you
have any problems or questions with regards to MPS backend usage, please, file an issue with `),Q=a("a"),Wt=s("PyTorch GitHub"),zt=s("."),this.h()},l(e){const l=So('[data-svelte="svelte-1phssyn"]',document.head);y=r(l,"META",{name:!0,content:!0}),l.forEach(o),$e=f(e),_=r(e,"H1",{class:!0});var Be=n(_);E=r(Be,"A",{id:!0,class:!0,href:!0});var Vt=n(E);te=r(Vt,"SPAN",{});var Jt=n(te);G(U.$$.fragment,Jt),Jt.forEach(o),Vt.forEach(o),Xe=f(Be),oe=r(Be,"SPAN",{});var Qt=n(oe);Ye=i(Qt,"Accelerated PyTorch Training on Mac"),Qt.forEach(o),Be.forEach(o),Ee=f(e),u=r(e,"P",{});var C=n(u);Ze=i(C,`With PyTorch v1.12 release, developers and researchers can take advantage of Apple silicon GPUs for significantly faster model training.
This unlocks the ability to perform machine learning workflows like prototyping and fine-tuning locally, right on Mac.
Apple\u2019s Metal Performance Shaders (MPS) as a backend for PyTorch enables this and can be used via the new `),ae=r(C,"CODE",{});var Xt=n(ae);et=i(Xt,'"mps"'),Xt.forEach(o),tt=i(C,` device.
This will map computational graphs and primitives on the MPS Graph framework and tuned kernels provided by MPS.
For more information please refer official documents `),q=r(C,"A",{href:!0,rel:!0});var Yt=n(q);ot=i(Yt,"Introducing Accelerated PyTorch Training on Mac"),Yt.forEach(o),at=i(C,`
and `),H=r(C,"A",{href:!0,rel:!0});var Zt=n(H);rt=i(Zt,"MPS BACKEND"),Zt.forEach(o),nt=i(C,"."),C.forEach(o),ke=f(e),g=r(e,"H3",{class:!0});var Re=n(g);k=r(Re,"A",{id:!0,class:!0,href:!0});var eo=n(k);re=r(eo,"SPAN",{});var to=n(re);G(B.$$.fragment,to),to.forEach(o),eo.forEach(o),st=f(Re),ne=r(Re,"SPAN",{});var oo=n(ne);it=i(oo,"Benefits of Training and Inference using Apple M1 Chips"),oo.forEach(o),Re.forEach(o),Ae=f(e),m=r(e,"OL",{});var Z=n(m);se=r(Z,"LI",{});var ao=n(se);lt=i(ao,"Enables users to train larger networks or batch sizes locally"),ao.forEach(o),ct=f(Z),ie=r(Z,"LI",{});var ro=n(ie);ht=i(ro,`Reduces data retrieval latency and provides the GPU with direct access to the full memory store due to unified memory architecture.
Therefore, improving end-to-end performance.`),ro.forEach(o),pt=f(Z),le=r(Z,"LI",{});var no=n(le);ft=i(no,"Reduces costs associated with cloud-based development or the need for additional local GPUs."),no.forEach(o),Z.forEach(o),Te=f(e),b=r(e,"P",{});var Pe=n(b);ce=r(Pe,"STRONG",{});var so=n(ce);dt=i(so,"Pre-requisites"),so.forEach(o),ut=i(Pe,`: To install torch with mps support,
please follow this nice medium article `),R=r(Pe,"A",{href:!0,rel:!0});var io=n(R);mt=i(io,"GPU-Acceleration Comes to PyTorch on M1 Macs"),io.forEach(o),vt=i(Pe,"."),Pe.forEach(o),Me=f(e),P=r(e,"H2",{class:!0});var je=n(P);A=r(je,"A",{id:!0,class:!0,href:!0});var lo=n(A);he=r(lo,"SPAN",{});var co=n(he);G(j.$$.fragment,co),co.forEach(o),lo.forEach(o),wt=f(je),pe=r(je,"SPAN",{});var ho=n(pe);yt=i(ho,"How it works out of the box"),ho.forEach(o),je.forEach(o),Se=f(e),X=r(e,"P",{});var po=n(X);_t=i(po,"On your machine(s) just run:"),po.forEach(o),xe=f(e),G(F.$$.fragment,e),Ce=f(e),T=r(e,"P",{});var Fe=n(T);gt=i(Fe,"and answer the questions asked, specifically choose "),fe=r(Fe,"CODE",{});var fo=n(fe);bt=i(fo,"MPS"),fo.forEach(o),Pt=i(Fe," for the query:"),Fe.forEach(o),Oe=f(e),G(W.$$.fragment,e),Ge=f(e),M=r(e,"P",{});var We=n(M);$t=i(We,`This will generate a config file that will be used automatically to properly set
the default options when doing `),de=r(We,"CODE",{});var uo=n(de);Et=i(uo,"accelerate launch"),uo.forEach(o),kt=i(We,", such as the one shown below:"),We.forEach(o),Ie=f(e),G(z.$$.fragment,e),Le=f(e),Y=r(e,"P",{});var mo=n(Y);At=i(mo,`After this configuration has been made, here is how you run the CV example
(from the root of the repo) with MPS enabled:`),mo.forEach(o),Ne=f(e),G(K.$$.fragment,e),De=f(e),$=r(e,"H2",{class:!0});var ze=n($);S=r(ze,"A",{id:!0,class:!0,href:!0});var vo=n(S);ue=r(vo,"SPAN",{});var wo=n(ue);G(V.$$.fragment,wo),wo.forEach(o),vo.forEach(o),Tt=f(ze),me=r(ze,"SPAN",{});var yo=n(me);Mt=i(yo,"A few caveats to be aware of"),yo.forEach(o),ze.forEach(o),Ue=f(e),x=r(e,"OL",{});var Ke=n(x);J=r(Ke,"LI",{});var Ve=n(J);St=i(Ve,"For "),ve=r(Ve,"CODE",{});var _o=n(ve);xt=i(_o,"nlp_example.py"),_o.forEach(o),Ct=i(Ve,` the metrics are too bad when compared to CPU-only training.
This means certain operations in BERT model are going wrong using mps device and this needs to be fixed by PyTorch.`),Ve.forEach(o),Ot=f(Ke),d=r(Ke,"LI",{});var w=n(d);Gt=i(w,"Distributed setups "),we=r(w,"CODE",{});var go=n(we);It=i(go,"gloo"),go.forEach(o),Lt=i(w," and "),ye=r(w,"CODE",{});var bo=n(ye);Nt=i(bo,"nccl"),bo.forEach(o),Dt=i(w," are not working with "),_e=r(w,"CODE",{});var Po=n(_e);Ut=i(Po,"mps"),Po.forEach(o),qt=i(w,` device.
This means that currently only single GPU of `),ge=r(w,"CODE",{});var $o=n(ge);Ht=i($o,"mps"),$o.forEach(o),Bt=i(w," device type can be used."),w.forEach(o),Ke.forEach(o),qe=f(e),v=r(e,"P",{});var ee=n(v);Rt=i(ee,"Finally, please, remember that, \u{1F917} "),be=r(ee,"CODE",{});var Eo=n(be);jt=i(Eo,"Accelerate"),Eo.forEach(o),Ft=i(ee,` only integrates MPS backend, therefore if you
have any problems or questions with regards to MPS backend usage, please, file an issue with `),Q=r(ee,"A",{href:!0,rel:!0});var ko=n(Q);Wt=i(ko,"PyTorch GitHub"),ko.forEach(o),zt=i(ee,"."),ee.forEach(o),this.h()},h(){h(y,"name","hf:doc:metadata"),h(y,"content",JSON.stringify(Go)),h(E,"id","accelerated-pytorch-training-on-mac"),h(E,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),h(E,"href","#accelerated-pytorch-training-on-mac"),h(_,"class","relative group"),h(q,"href","https://pytorch.org/blog/introducing-accelerated-pytorch-training-on-mac/"),h(q,"rel","nofollow"),h(H,"href","https://pytorch.org/docs/stable/notes/mps.html"),h(H,"rel","nofollow"),h(k,"id","benefits-of-training-and-inference-using-apple-m1-chips"),h(k,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),h(k,"href","#benefits-of-training-and-inference-using-apple-m1-chips"),h(g,"class","relative group"),h(R,"href","https://medium.com/towards-data-science/gpu-acceleration-comes-to-pytorch-on-m1-macs-195c399efcc1"),h(R,"rel","nofollow"),h(A,"id","how-it-works-out-of-the-box"),h(A,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),h(A,"href","#how-it-works-out-of-the-box"),h(P,"class","relative group"),h(S,"id","a-few-caveats-to-be-aware-of"),h(S,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),h(S,"href","#a-few-caveats-to-be-aware-of"),h($,"class","relative group"),h(Q,"href","https://github.com/pytorch/pytorch/issues"),h(Q,"rel","nofollow")},m(e,l){t(document.head,y),c(e,$e,l),c(e,_,l),t(_,E),t(E,te),I(U,te,null),t(_,Xe),t(_,oe),t(oe,Ye),c(e,Ee,l),c(e,u,l),t(u,Ze),t(u,ae),t(ae,et),t(u,tt),t(u,q),t(q,ot),t(u,at),t(u,H),t(H,rt),t(u,nt),c(e,ke,l),c(e,g,l),t(g,k),t(k,re),I(B,re,null),t(g,st),t(g,ne),t(ne,it),c(e,Ae,l),c(e,m,l),t(m,se),t(se,lt),t(m,ct),t(m,ie),t(ie,ht),t(m,pt),t(m,le),t(le,ft),c(e,Te,l),c(e,b,l),t(b,ce),t(ce,dt),t(b,ut),t(b,R),t(R,mt),t(b,vt),c(e,Me,l),c(e,P,l),t(P,A),t(A,he),I(j,he,null),t(P,wt),t(P,pe),t(pe,yt),c(e,Se,l),c(e,X,l),t(X,_t),c(e,xe,l),I(F,e,l),c(e,Ce,l),c(e,T,l),t(T,gt),t(T,fe),t(fe,bt),t(T,Pt),c(e,Oe,l),I(W,e,l),c(e,Ge,l),c(e,M,l),t(M,$t),t(M,de),t(de,Et),t(M,kt),c(e,Ie,l),I(z,e,l),c(e,Le,l),c(e,Y,l),t(Y,At),c(e,Ne,l),I(K,e,l),c(e,De,l),c(e,$,l),t($,S),t(S,ue),I(V,ue,null),t($,Tt),t($,me),t(me,Mt),c(e,Ue,l),c(e,x,l),t(x,J),t(J,St),t(J,ve),t(ve,xt),t(J,Ct),t(x,Ot),t(x,d),t(d,Gt),t(d,we),t(we,It),t(d,Lt),t(d,ye),t(ye,Nt),t(d,Dt),t(d,_e),t(_e,Ut),t(d,qt),t(d,ge),t(ge,Ht),t(d,Bt),c(e,qe,l),c(e,v,l),t(v,Rt),t(v,be),t(be,jt),t(v,Ft),t(v,Q),t(Q,Wt),t(v,zt),He=!0},p:xo,i(e){He||(L(U.$$.fragment,e),L(B.$$.fragment,e),L(j.$$.fragment,e),L(F.$$.fragment,e),L(W.$$.fragment,e),L(z.$$.fragment,e),L(K.$$.fragment,e),L(V.$$.fragment,e),He=!0)},o(e){N(U.$$.fragment,e),N(B.$$.fragment,e),N(j.$$.fragment,e),N(F.$$.fragment,e),N(W.$$.fragment,e),N(z.$$.fragment,e),N(K.$$.fragment,e),N(V.$$.fragment,e),He=!1},d(e){o(y),e&&o($e),e&&o(_),D(U),e&&o(Ee),e&&o(u),e&&o(ke),e&&o(g),D(B),e&&o(Ae),e&&o(m),e&&o(Te),e&&o(b),e&&o(Me),e&&o(P),D(j),e&&o(Se),e&&o(X),e&&o(xe),D(F,e),e&&o(Ce),e&&o(T),e&&o(Oe),D(W,e),e&&o(Ge),e&&o(M),e&&o(Ie),D(z,e),e&&o(Le),e&&o(Y),e&&o(Ne),D(K,e),e&&o(De),e&&o($),D(V),e&&o(Ue),e&&o(x),e&&o(qe),e&&o(v)}}}const Go={local:"accelerated-pytorch-training-on-mac",sections:[{local:null,sections:[{local:"benefits-of-training-and-inference-using-apple-m1-chips",title:"Benefits of Training and Inference using Apple M1 Chips"}],title:null},{local:"how-it-works-out-of-the-box",title:"How it works out of the box"}],title:"Accelerated PyTorch Training on Mac"};function Io(Kt){return Co(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class Uo extends Ao{constructor(y){super();To(this,y,Io,Oo,Mo,{})}}export{Uo as default,Go as metadata};
